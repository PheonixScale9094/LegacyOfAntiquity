namespace = mondragon_events

# Mondragon Formation
country_event = {
	id = mondragon_events.1
	title = "mondragon_events.1.t"
	desc = "mondragon_events.1.d"
	picture = MERCHANTS_TALKING_eventPicture

	is_triggered_only = no

	trigger = {
		has_reform = merchant_elite_reform
		NOT = { has_country_flag = mondragon_company }
		#year = 1444
	}
	
	mean_time_to_happen = {
		days = 1
	}

	immediate = {
		set_country_flag = mondragon_company
	}

	# Reject
	option = {
		name = "mondragon_events.1.a"
		change_estate_land_share = {
			estate = estate_mondragon
			share = -30
		}
	}

	# Approve
	option = {
		name = "mondragon_events.1.b"
		change_estate_land_share = {
			estate = estate_mondragon
			share = -20
		}
	}
}

#Corporate Restructuring
country_event = {
	id = mondragon_events.2
	title = "mondragon_events.2.t"
	desc = "mondragon_events.2.d"
	picture = HOUSE_OF_TRADE_eventPicture

	is_triggered_only = no

	trigger = {
		has_reform = merchant_elite_reform
		has_estate = estate_mondragon
		NOT = { has_country_flag = mondragon_corporation }
		OR = {
			num_of_ports = 1
			num_of_total_ports = 15
		}
	}
	
	mean_time_to_happen = {
		days = 1
	}

	immediate = {
		set_estate_privilege = estate_mondragon_supremacy_over_crown
	}

	#  Free
	option = {
		name = "mondragon_events.2.a"
		set_country_flag = mondragon_corporation
		change_estate_land_share = {
			estate = estate_mondragon
			share = 15
		}
	}
	
	# Regulate
	option = {
		name = "mondragon_events.2.b"
		set_country_flag = mondragon_corporation
		add_mercantilism = 2
		change_estate_land_share = {
			estate = estate_mondragon
			share = 10
		}
	}
	
	# Heavily Regulate
	option = {
		name = "mondragon_events.2.c"
		set_country_flag = mondragon_corporation
		add_mercantilism = 4
		change_estate_land_share = {
			estate = estate_mondragon
			share = 5
		}
	}
}

##################
#Disaster
##################
#Ultimatum
country_event = {
	id = mondragon_events.3
	title = "mondragon_events.3.t"
	desc = "mondragon_events.3.d"
	picture = DIPLOMACY_eventPicture

	is_triggered_only = yes
	
	immediate = {
		set_country_flag = mondragon_ultimatum
		clr_country_flag = mondragon_ultimatum_paid
	}

	# Respect!
	option = {
		name = "mondragon_events.3.a"
	}
}

#Outcome
country_event = {
	id = mondragon_events.4
	title = "mondragon_events.4.t"
	desc = "mondragon_events.4.d"
	picture = COUNTRY_COLLAPSE_eventPicture

	is_triggered_only = yes

	immediate = {
	clr_country_flag = mondragon_ultimatum
	}

	# We Must Accept
	option = {
		name = "mondragon_events.4.a"
		every_country = {
			limit = {
				is_in_trade_league_with = ROOT
			}
			country_event = { 
				id = mondragon_events.5
				days = 1
				random = 5
			}
		}
		change_tag = MDR
		add_government_reform = corporation_reform
		if = {
			limit = { has_custom_ideas = no }
			swap_free_idea_group = yes
		}
		remove_country_modifier = corporate_influence_mod
		remove_country_modifier = corporate_influence_mod_reduced
		remove_country_modifier = corporate_influence_mod_minimal
	}
}

#Trade League Vassal Event
country_event = {
	id = mondragon_events.5
	title = "mondragon_events.5.t"
	desc = "mondragon_events.5.d"
	picture = COUNTRY_COLLAPSE_eventPicture

	is_triggered_only = yes

	immediate = {
	clr_country_flag = mondragon_ultimatum
	}

	#Join
	option = {
		name = "mondragon_events.5.a"
		MDR = {
			country_event = { 
				id = mondragon_events.6
				days = 0
			}
		}
		
		ai_chance = {
			factor = 3
			trigger = {
				factor = 2
				has_reform = trading_city
			}
			trigger = {
				factor = 2
				NOT = { government_rank = 2 }
			}
		}
	}
	
	#Leave
	option = {
		name = "mondragon_events.5.b"
		ai_chance = {
			factor = 1
			trigger = {
				factor = 2
				government_rank = 2
			}
		}
	}
}

#Vassal Option
country_event = {
	id = mondragon_events.6
	title = "mondragon_events.6.t"
	desc = "mondragon_events.6.d"
	picture = COUNTRY_COLLAPSE_eventPicture

	is_triggered_only = yes
	
	#Accept
	option = {
		name = "mondragon_events.6.a"
		vassalize = FROM
		FROM = { 
			set_government_rank = 1
			change_government = republic
			add_government_reform = corporation_reform
			add_government_reform = branch_office
		}
		
		ai_chance = {
			factor = 1
		}
	}
	
	#Reject
	option = {
		name = "mondragon_events.6.b"
		ai_chance = {
			factor = 0
		}
	}
}


##################
#Random Events
##################
#Mondragon Purchase
province_event = {
	id = mondragon_events.7
	title = "mondragon_events.7.t"
	desc = "mondragon_events.7.d"
	picture = COUNTRY_COLLAPSE_eventPicture
	
	trigger = {
		owner = 
			has_reform = merchant_elite_reform
			has_estate = estate_mondragon
			has_country_flag = mondragon_corporation
		}
		NOT = { local_autonomy = 10 }
	}
	
	mean_time_to_happen = {
		months = 450

        modifier = {
            factor = 0.5
			estate_territory = {
					estate = estate_mondragon
					territory = 20
			}
        }
        modifier = {
            factor = 0.5
			estate_territory = {
					estate = estate_mondragon
					territory = 40
			}
        }
	}
	
	#Accept
	option = {
		name = "mondragon_events.7.a"
		ROOT = {
			add_province_modifier = { 
				name = corporate_province_control
				duration = -1
				desc = corporate_province_control_tooltip
			}
			owner = {
				change_estate_land_share = {
					estate = estate_mondragon
					share = 2
				}
			}
		}
		ai_chance = {
			factor = 1
		}
	}
	
	#Reject
	option = {
		name = "mondragon_events.7.b"
		owner = {
			add_adm_power = -15
		}
		ai_chance = {
			factor = 0
		}
	}
}